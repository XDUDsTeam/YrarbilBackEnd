# Yrarbil 后端 wiki

本文档是关于与如何使用后端的wiki。

## 获得源码

YrarbilBackend 是遵循 BSD3 的开源项目，可以在 GitHub 上找到我们的代码，
其中 YrarbilRelease Repo 中可以找到也已经打包好的 Hackage 包。

## 编译

得益于Haskell 成熟的 包管理机智与软件，后端的部署相对简单。
编译需要的是 Haskell 的 GHC 编译器，其中我们测试的是 7.10.2的版本；同时需要cabal，我们所使用的是GHC-7.10.2 配套的版本。

后端理论上可以部署在 包括 Windows, Linux, OS X 10.x, FreeBSD, NetBSD, 等 类-Unix 与 非 Unix 类系统中。
但是有遗憾的是，目前Windows 下无法直接编译， 由于编译器的缘故，但可以在 Linux 下 使用 mingw 与 wine 为 Win 交叉编译。
同时 7.10.3 的版本编译器 可能会解决该问题。

### Linux 类系统下的编译。

首先 需要明确的是，当前编译后端程序的机子，是否还会编译 后端所使用的数据库 PostgreSQL。
如果是，请先阅读后续关于数据库的内容，编译完数据库的程序之后，再次从此阅读。
如果不是，安装的第一步是安装 libpq 。通过 linux 各发行版 的包管理系统安装，所需的版本。

然后是安装 GHC 由于 Cabal。
安装 鉴于某些发行版的包管理器中的两者的版本过低，我们建议从官网下载安装包安装。
此外，暂无法保证 7.10.x 之前的版本能否正常编译。

之后，当安装好GHC 与 Cabal 之后，我们需要做的事，将代码“拿出来”。
首先，如果 拿到的不是 .tar.gz 文件，那么直接在代码的根目录下执行
```
cabal sandbox init
```
初始化一个 沙盒。如果拿到的是，新建一个文件夹，在那个文件夹中初始化一个沙盒。
在将 代码 安装入 沙盒，可能是执行：
```
cabal install
```
也可能是
```
cabal install PATH_OF_TAR_GZ
```
编译安装完之后可在 .cabal-sandbox/bin 文件夹中找到二进制代码。

最后需要将 沙盒的 添加到 PATH 环境变量之中。

## 使用
使用启动器来启动即可。键入
```
yb.launch -?
```
可获取帮助。

### 其他系统

参考Linux 下的安装方式安装。

## 使用 docker

如果希望使用 docker 容器 运行后端，
则可直接获取 docker 镜像，然后部署。
其中需要注意的是，其中需要使用 PostgreSQL 数据库。
需要使用者为其提供数据库服务，并在容器的环境变量中添加相对的内容。
具体内容可参见后端参考文档。
